<html xmlns="http://www.thymeleaf.org">
<head>
    <!--/*/ <th:block th:include="fragments/head :: head"/> /*/-->
    <!-- DataTables CSS -->
    <link th:href="@{vendor/datatables-plugins/dataTables.bootstrap.css}" rel="stylesheet"/>

    <!-- DataTables Responsive CSS -->
    <link th:href="@{vendor/datatables-responsive/dataTables.responsive.css}" rel="stylesheet"/>
</head>

<body>
    <div th:include="fragments/menu :: menu"></div>

    <div id="wrapper">
        <div id="page-wrapper">
            <div class="row">
                <form role="form">
                    <div class="col-lg-3">
                        <label>单位</label><input class="form-control"/>
                    </div>
                    <div class="col-lg-3">
                        <label>部门</label><input class="form-control"/>
                    </div>
                    <div class="col-lg-3">
                        <label>用户名</label><input class="form-control"/>
                    </div>
                    <div class="col-lg-3">
                        <button class="btn btn-success" style="margin-top:1.7em;">查 询</button>
                    </div>
                </form>
                <!-- /.col-lg-12 -->
            </div>
            <hr/>
            <div class="row">
                <div class="col-lg-12">
                    <div style="margin-bottom:1.5em;">
                        <button id="addUserBtn" class="btn btn-primary" data-toggle="modal" data-target="#userModal">新增用户</button>
                    </div>

                    <!-- 模态框（Modal） -->
                    <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title" id="userModalLabel">
                                        新增用户
                                    </h4>
                                </div>
                                <form id="saveUserForm" role="form" action="#" th:action="@{/saveUser}" th:object="${user}" method="post">
                                    <div class="modal-body">
                                        <div class="row">
                                            <input type="hidden" id="id" name="id"/>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>所在单位</label> 
                                                    <select class="form-control" name="corpId" >
                                                        <option value=""></option>
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>所在部门</label> 
                                                    <select class="form-control" name="deptId">
                                                        <option value=""></option>
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>用户名</label> 
                                                    <input class="form-control" id="name" name="name"/>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>姓名</label> 
                                                    <input class="form-control" id="realName" name="realName" th:value="${realName}"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>设置密码</label> 
                                                    <input class="form-control" type="password" name="password"/>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="form-group">
                                                    <label>验证密码</label> 
                                                    <input class="form-control" type="password" name="confirmPassword"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-lg-12">
                                                <div class="form-group">
                                                    <label>角色</label> 
                                                    <select class="form-control" name="roleId" >
                                                        <option value=""></option>
                                                        <option value="1">1</option>
                                                        <option value="2">2</option>
                                                        <option value="3">3</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    <!-- modal-body end!-->
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                        <input id="btnSaveUser" type="submit" class="btn btn-primary" value="保存"/>
                                        <button type="button" class="btn btn-info hidden" id="resetBtn">重置表单</button>
                                    </div>
                                </form>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>


                    <div class="panel panel-default">

                        <div class="panel-heading">
                            用户列表
                        </div>
                        <div class="panel-body">
                            <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-user">
                                <thead>
                                    <tr>
                                        <th class="hidden">ID</th>
                                        <th>用户名</th>
                                        <th>昵称</th>
                                        <th>部门</th>
                                        <th>单位</th>
                                        <th>角色</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="user-list">
                                    <!-- 动态加载数据-->
                                </tbody>
                            </table>
                            <div class="form-inline" style="float:right;">
                                每页条数:
                                <select  class="form-control">
                                    <option>5</option>
                                    <option>10</option>
                                    <option>20</option>
                                </select>
                                <a class="btn btn-default">第一页</a>
                                <a class="btn btn-default">上一页</a>
                                <input class="form-control" type="text" size="5"/>
                                <a class="btn btn-default">下一页</a>
                                <a class="btn btn-default">最后一页</a>
                                总记录数:xx条
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- /#page-wrapper -->
    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script th:src="@{vendor/jquery/jquery.min.js}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script th:src="@{vendor/bootstrap/js/bootstrap.min.js}"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script th:src="@{vendor/metisMenu/metisMenu.min.js}"></script>

    <!-- Custom Theme JavaScript -->
    <script th:src="@{dist/js/sb-admin-2.js}"></script>

    <script th:src="@{dist/js/bootstrapValidator.min.js}"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function(){
            $('#saveUserForm').bootstrapValidator({
//        live: 'disabled',
                message: 'This value is not valid',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    corpId: {
                        validators: {
                            notEmpty: {
                                message: '请选择单位'
                            }
                        }
                    },
                    deptId: {
                        validators: {
                            notEmpty: {
                                message: '请选择部门'
                            }
                        }
                    },
                    name: {
                        validators: {
                            notEmpty: {
                                message: '请填写用户名'
                            }
                        }
                    },
                    realName: {
                        validators: {
                            notEmpty: {
                                message: '请填写昵称'
                            }
                        }
                    },
                    password: {
                        validators: {
                            notEmpty: {
                                message: '密码不能为空'
                            },
                            different: {
                                field: 'name',
                                message: '密码不能与用户名相同'
                            }
                        }
                    },
                    confirmPassword: {
                        validators: {
                            notEmpty: {
                                message: '请再次填写确认密码'
                            },
                            identical: {
                                field: 'password',
                                message: '两次密码输入不一致'
                            },
                            different: {
                                field: 'name',
                                message: '密码不能与用户名相同'
                            }
                        }
                    },
                    roleId:{
                        validators:{
                            notEmpty: {
                                message: '请为用户分配角色'
                            }
                        }
                    }

                }
            });

            // 表单验证
            $('#btnSaveUser').click(function() {
                $('#saveUserForm').bootstrapValidator('validate');
                //验证通过提交表单
                if($('#saveUserForm').data("bootstrapValidator").isValid()){
                    document.getElementById("saveUserForm").submit();
                }
            });

            $('#resetBtn').bind("click",function() {
                        $('#saveUserForm').data('bootstrapValidator').resetForm(true);
                    }
            );
        });

        $(function(){
            var pageNum = 1;
            var pageSize = 10;
            queryUser(pageNum, pageSize);
        });

        // 定义一个数组,用来存放用户信息
        var userArray = new Array();
        function queryUser(pageNum, pageSize){
            $.post("userlist/" + pageNum + "/" + pageSize,
                function(data){
                    var users = data.list;
                    console.log(data);
                    for(var i=0; i < users.length; i++){
                        userArray.push(users[i]);
                        $("#user-list").append(
                                '<tr>'+
                                '<td>'+ users[i].name+'</td>' + //用户名
                                '<td>'+ users[i].realName+'</td>'+//昵称
                                '<td>'+ users[i].corpId+'</td>'+//单位
                                '<td>'+ users[i].deptId+'</td>'+//部门
                                '<td></td>'+//部门
                                '<td class="center">'+
                                    '<a href="javascript:void(0)" data-toggle="modal" onclick="editUser('+i+')">修改</a> '+
                                    '<a href="javascript:void(0)">删除</a>'+
                                '</td>'+
                                '</tr>'
                        );
                    }

                });
        }

        // 修改用户信息
        // 根据下标访问userArray数据,获取用户信息
        function editUser(index){
            var user = userArray[index];
            $("#userModalLabel").html("修改用户");
            $("#userModal").modal('show');
            $("#id").val(user.id);
            $("#name").val(user.name);
            $("#realName").val(user.realName);
            // $("#corpId").get(0).value = user.corpId;
            // $("#deptId").get(0).value = user.deptId;
        }

        //
        $(function () { $('#userModal').modal('hide')});
        // hidden.bs.modal	当模态框完全对用户隐藏时触发。
        $(function () { $('#userModal').on('hide.bs.modal', function () {
                // 重置表单
                $("#resetBtn").click();
            });
        });
        /*]]>*/
    </script>

</body>

</html>
